

CREATE TABLE DEPARTAMENTO (
    DNUMERO INT PRIMARY KEY,
    DNOME VARCHAR(30),
    CPF_GERENTE VARCHAR(15)
);

CREATE TABLE FUNCIONARIO (
    CPF VARCHAR(15) PRIMARY KEY,
    FUNCIONARIO_CPF VARCHAR(15),
    DEPARTAMENTO_DNUMERO INT,
    PNOME VARCHAR(60),
    UNOME VARCHAR(30),
    ENDERECO VARCHAR(80),
    SEXO CHAR(1),
    SALARIO REAL,
    FOREIGN KEY (FUNCIONARIO_CPF) REFERENCES FUNCIONARIO(CPF),
    FOREIGN KEY (DEPARTAMENTO_DNUMERO) REFERENCES DEPARTAMENTO(DNUMERO)
);

CREATE TABLE DEPENDENTE (
    CPF VARCHAR(15),
    NOME_DEPENDENTE VARCHAR(60),
    PARENTESCO VARCHAR(20),
    FOREIGN KEY (CPF) REFERENCES FUNCIONARIO(CPF)
);

CREATE TABLE PROJETO (
    PNUMERO INT PRIMARY KEY,
    PJNOME VARCHAR(30),
    DNUMERO INT,
    FOREIGN KEY (DNUMERO) REFERENCES DEPARTAMENTO(DNUMERO)
);

CREATE TABLE TRABALHA_EM (
    FUNCIONARIO_CPF VARCHAR(15),
    PROJETO_PNUMERO INT,
    FOREIGN KEY (FUNCIONARIO_CPF) REFERENCES FUNCIONARIO(CPF),
    FOREIGN KEY (PROJETO_PNUMERO) REFERENCES PROJETO(PNUMERO)
);


INSERT INTO DEPARTAMENTO (DNUMERO, DNOME, CPF_GERENTE) VALUES
  (1, 'Pesquisa', '1001'),
  (2, 'Vendas',   '1002'),
  (3, 'Recursos Humanos', '1003');

INSERT INTO FUNCIONARIO VALUES
  ('1001', NULL,     1,           'Pedro',       'Silva',   'Av. A, 100',          'M', 50000),
  ('1002', '1001',   2,           'Maria',       'Souza',   'Rua B, 200',          'F', 25000),
  ('1003', '1001',   3,           'João',        'Pereira', 'Travessa C, 30',      'M', 15000),
  ('1004', '1002',   1,           'Ana',         'Costa',   'Alameda D, 45',       'F', 35000),
  ('1005', '1002',   1,           'Luiz',        'Oliveira', 'Praça E, 9',         'M', 29000),
  ('1006', '1003',   2,           'Carla',       'Dias',    'Estrada F, 77',       'F', 45000);

INSERT INTO DEPENDENTE VALUES
  ('1001', 'Lucas Silva',    'Filho'),
  ('1002', 'Mariana Souza',  'Filha'),
  ('1002', 'Beatriz Souza',  'Filha'),
  ('1003', 'Pedro Pereira',  'Filho');

INSERT INTO PROJETO VALUES
  (1, 'Projeto Alpha',   1),
  (2, 'Projeto Beta',    1),
  (3, 'Projeto Gamma',   2),
  (4, 'Projeto Delta',   3);

INSERT INTO TRABALHA_EM VALUES
  ('1001', 1),
  ('1001', 2),
  ('1001', 3),
  ('1002', 1),
  ('1002', 3),
  ('1003', 3),
  ('1003', 4),
  ('1004', 1),
  ('1005', 2),
  ('1006', 1),
  ('1006', 2),
  ('1006', 3),
  ('1006', 4);


SELECT PNOME, UNOME, SALARIO FROM FUNCIONARIO;
SELECT * FROM FUNCIONARIO WHERE SALARIO > 30000;
SELECT FUNCIONARIO_CPF FROM TRABALHA_EM WHERE PROJETO_PNUMERO IN (1, 2, 3);
SELECT DNOME FROM DEPARTAMENTO ORDER BY DNOME ASC;

SELECT F.PNOME, F.UNOME, F.ENDERECO
FROM FUNCIONARIO F
INNER JOIN DEPARTAMENTO D ON F.DEPARTAMENTO_DNUMERO = D.DNUMERO
WHERE D.DNOME = 'Pesquisa';

SELECT F.PNOME AS FUNCIONARIO, F.UNOME, 
       S.PNOME AS SUPERVISOR_PNOME, S.UNOME AS SUPERVISOR_UNOME
FROM FUNCIONARIO F
LEFT JOIN FUNCIONARIO S ON F.FUNCIONARIO_CPF = S.CPF;

SELECT COUNT(DISTINCT SALARIO) AS SALARIOS_UNICOS FROM FUNCIONARIO;

SELECT MAX(SALARIO) AS MAIOR_SALARIO, MIN(SALARIO) AS MENOR_SALARIO FROM FUNCIONARIO;

SELECT DEPARTAMENTO_DNUMERO, COUNT(*) AS TOTAL_FUNCIONARIOS, AVG(SALARIO) AS MEDIA_SALARIAL
FROM FUNCIONARIO
GROUP BY DEPARTAMENTO_DNUMERO;

SELECT PROJETO_PNUMERO, COUNT(*) AS TOTAL_FUNCIONARIOS
FROM TRABALHA_EM
GROUP BY PROJETO_PNUMERO
HAVING COUNT(*) > 2;

SELECT PNOME, UNOME
FROM FUNCIONARIO
WHERE CPF IN (
    SELECT CPF
    FROM DEPENDENTE
    GROUP BY CPF
    HAVING COUNT(*) >= 2
);

SELECT F.PNOME, F.UNOME
FROM FUNCIONARIO F
WHERE EXISTS (
    SELECT 1
    FROM DEPARTAMENTO D
    WHERE D.CPF_GERENTE = F.CPF
)
AND EXISTS (
    SELECT 1
    FROM DEPENDENTE D
    WHERE D.CPF = F.CPF
);

SELECT DISTINCT F.PNOME, F.UNOME
FROM FUNCIONARIO F
JOIN TRABALHA_EM TE ON F.CPF = TE.FUNCIONARIO_CPF
JOIN PROJETO P ON TE.PROJETO_PNUMERO = P.PNUMERO
JOIN DEPARTAMENTO D ON P.DNUMERO = D.DNUMERO
WHERE D.DNOME = 'Pesquisa'
  AND F.CPF IN (
      SELECT CPF
      FROM DEPENDENTE
  )
  AND F.SALARIO > (
      SELECT AVG(SALARIO)
      FROM FUNCIONARIO
  );
